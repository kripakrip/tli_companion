# TLI Companion โ ะัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั

> ะะพะบัะผะตะฝั ัะพะทะดะฐะฝ: 2026-01-13
> ะกัะฐััั: ะะปะฐะฝะธัะพะฒะฐะฝะธะต ะธ ะพะฑััะถะดะตะฝะธะต

---

## ๐ ะกะพะดะตัะถะฐะฝะธะต

1. [ะัะพะฑะปะตะผะฐ ััะฐัะพะฒ ะฟัะตะดะผะตัะพะฒ](#1-ะฟัะพะฑะปะตะผะฐ-ััะฐัะพะฒ-ะฟัะตะดะผะตัะพะฒ)
2. [ะัะพะฑะปะตะผะฐ ะปะธะณ](#2-ะฟัะพะฑะปะตะผะฐ-ะปะธะณ)
3. [ะะธะทะฐะนะฝ ะพะฒะตัะปะตั](#3-ะดะธะทะฐะนะฝ-ะพะฒะตัะปะตั)
4. [ะะพะฟะพะปะฝะธัะตะปัะฝัะต ััะฝะบัะธะธ](#4-ะดะพะฟะพะปะฝะธัะตะปัะฝัะต-ััะฝะบัะธะธ)
5. [ะกะธััะตะผะฐ ะฐะฒัะพัะธะทะฐัะธะธ](#5-ัะธััะตะผะฐ-ะฐะฒัะพัะธะทะฐัะธะธ)

---

## 1. ะัะพะฑะปะตะผะฐ ััะฐัะพะฒ ะฟัะตะดะผะตัะพะฒ โ ะะะจะะะ

### ะะฟะธัะฐะฝะธะต
ะะตะบะพัะพััะต ะฟัะตะดะผะตัั ะธะผะตัั ัะฐะทะฝัะต ััะฐัั/ะบะฐัะตััะฒะพ ะธ ัะตะฝะฐ ัะธะปัะฝะพ ะทะฐะฒะธัะธั ะพั ะบะพะฝะบัะตัะฝะพะณะพ ัะบะทะตะผะฟะปััะฐ:
- ะัะตะดะผะตั ั ัะพัะพัะธะผะธ ััะฐัะฐะผะธ = 1000 FE
- ะขะพั ะถะต ะฟัะตะดะผะตั ั ะฟะปะพัะธะผะธ ััะฐัะฐะผะธ = 1 FE
- ะะพ ัะตะฝะฐ ะทะฐะฟะธััะฒะฐะตััั ะฝะฐ ะพะดะธะฝ `game_id`

### ะะตัะตะฝะธะต: ะะตะปัะน ัะฟะธัะพะบ ะฟัะตะดะผะตัะพะฒ

**ะะตะฐะปะธะทะพะฒะฐะฝะพ 2026-01-13:**

1. **ะัะฐะนััะตะบะธ:** ะัะปะธ ะฟัะตะดะผะตัะฐ ะฝะตั ะฒ `tli_game_items`:
   - โ ะฆะตะฝะฐ ะะ ะทะฐะฟะธััะฒะฐะตััั ะฒ ะะ
   - โ ะขะพะปัะบะพ ัะฐะบั ะฒัััะตัะธ ะทะฐะฟะธััะฒะฐะตััั ะฒ `tli_unknown_items`

2. **ะัะพะฟั:** ะัะปะธ ะฟัะตะดะผะตัะฐ ะฝะตั ะฒ `items_cache`:
   - โ ะัะพะฟ ะธะณะฝะพัะธััะตััั ะฟะพะปะฝะพัััั
   - โ ะะต ะฒะปะธัะตั ะฝะฐ ััะฐัะธััะธะบั ัะตััะธะธ

### ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั
- `src-tauri/src/state.rs` โ ััะฝะบัะธั `add_drop()` ัะตะฟะตัั ะฟัะพะฒะตััะตั `items_cache`

### ะงัะพ ะพััะปะตะถะธะฒะฐะตััั
- โ ะะฐะปััะฐ (Flame Elementium, Flame Sand, etc.)
- โ ะะฐัะตัะธะฐะปั (Fossils, Erosion, Wedges, etc.)
- โ ะกะบะธะปั (Precise, Activation Medium, etc.)
- โ ะคะปัะพัะตััะตะฝัั, ะัะธะทะผั, ะะพะผะฟะฐัั, etc.
- โ ะญะบะธะฟะธัะพะฒะบะฐ ัะพ ััะฐัะฐะผะธ โ ะะ ะพััะปะตะถะธะฒะฐะตััั

---

## 2. ะัะพะฑะปะตะผะฐ ะปะธะณ โ ะะะจะะะ

### ะะฟะธัะฐะฝะธะต
ะ ะธะณัะต ัััะตััะฒััั ัะฐะทะฝัะต ะปะธะณะธ:
- **ะกะตะทะพะฝะฝะฐั ะปะธะณะฐ** (SS11, SS12...) โ ะฐะบััะฐะปัะฝัะน ะบะพะฝัะตะฝั
- **Standard** โ ะฟะพััะพัะฝะฝะฐั ะปะธะณะฐ, ะดััะณะฐั ัะบะพะฝะพะผะธะบะฐ

ะฆะตะฝั ะฝะฐ ะพะดะฝะธ ะธ ัะต ะถะต ะฟัะตะดะผะตัั ะผะพะณัั ัะธะปัะฝะพ ะพัะปะธัะฐัััั ะผะตะถะดั ะปะธะณะฐะผะธ.

### ะะตัะตะฝะธะต: ะะธะฑัะธะดะฝัะน ะฟะพะดัะพะด (B + C)

**ะะตะฐะปะธะทะพะฒะฐะฝะพ 2026-01-13:**

#### 1. ะขะฐะฑะปะธัะฐ `tli_league_settings` โ
```sql
- id, league_name (SS10, SS11...)
- start_date โ ะดะฐัะฐ ััะฐััะฐ ะปะธะณะธ
- detection_pause_days โ ัะบะพะปัะบะพ ะดะฝะตะน ะฝะต ะดะตัะตะบัะธัั ะฐะฝะพะผะฐะปะธะธ
- is_active โ ัะตะบััะฐั ะฐะบัะธะฒะฝะฐั ะปะธะณะฐ
```

#### 2. League ID ะฒ ัะฐะฑะปะธัะฐั ัะตะฝ โ
```sql
- tli_market_prices.league_id
- tli_current_prices.league_id
```

#### 3. ะขะฐะฑะปะธัะฐ `tli_suspicious_prices` โ
```sql
- id, game_id, price_record_id (UUID)
- old_avg_price, new_price, deviation_percent
- reported_at, reviewed_at, reviewed_by
- status: pending | approved | rejected
- league_id
```

#### 4. ะะตัะตะบัะธั ะฐะฝะพะผะฐะปะธะน ะฒ RPC โ
- `upsert_market_price` ะฟัะพะฒะตััะตั ะพัะบะปะพะฝะตะฝะธะต ะพั ััะตะดะฝะตะน
- ะะพัะพะณ: > 50% โ ะฟะพะดะพะทัะธัะตะปัะฝะพ
- ะ ะฟะตัะธะพะด "ััะฐัั ะปะธะณะธ" โ ะดะตัะตะบัะธั ะพัะบะปััะตะฝะฐ

#### 5. ะะดะผะธะฝ-ะฟะฐะฝะตะปั `/admin/prices` โ
**ะขัะธ ะฒะบะปะฐะดะบะธ:**
- ๐ **ะะพะดะตัะฐัะธั** โ ะฟะพะดะพะทัะธัะตะปัะฝัะต ัะตะฝั ั ะบะฝะพะฟะบะฐะผะธ โ/โ
- ๐ฐ **ะขะตะบััะธะต ัะตะฝั** โ ัะฐะฑะปะธัะฐ ะฒัะตั ัะตะฝ ั ะฟะพะธัะบะพะผ, ัะธะปัััะฐะผะธ, ัะพััะธัะพะฒะบะพะน
- โ๏ธ **ะะธะณะธ** โ ัะฟัะฐะฒะปะตะฝะธะต ัะตะทะพะฝะฐะผะธ, ะฟะตัะตะบะปััะตะฝะธะต ะฐะบัะธะฒะฝะพะน ะปะธะณะธ

#### 6. Telegram ัะฒะตะดะพะผะปะตะฝะธั โ
- Edge Function `notify-suspicious-price`
- ะขัะธะณะณะตั ะฝะฐ INSERT ะฒ `tli_suspicious_prices`
- ะกะพะพะฑัะตะฝะธะต: "โ๏ธ ะะพะดะพะทัะธัะตะปัะฝะฐั ัะตะฝะฐ: Item โ ะฑัะปะพ X, ััะฐะปะพ Y (-Z%)"

#### 7. Fallback ัะตะฝ ะฟัะตะดัะดััะตะณะพ ัะตะทะพะฝะฐ โ
- RPC `get_prices_with_fallback()`:
  - ะะพะทะฒัะฐัะฐะตั ัะตะฝั ัะตะบััะตะน ะปะธะณะธ
  - ะัะปะธ ะฝะตั ัะตะฝั โ ะฑะตััั ะธะท ะฟัะตะดัะดััะตะน ะปะธะณะธ ั ัะปะฐะณะพะผ `is_current_league = false`
- Tauri ะฟัะธะปะพะถะตะฝะธะต ะฟะพะบะฐะทัะฒะฐะตั ะฑะตะนะดะถ **โ๏ธ SS10** ะดะปั ััะฐััั ัะตะฝ
- Tooltip: "ะฆะตะฝะฐ ะธะท SS10, ะฝัะถะตะฝ ะฝะพะฒัะน ะฟัะฐะนััะตะบ"

### ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั
- `supabase_sync.rs` โ `fetch_prices_with_fallback()`
- `state.rs` โ `merge_prices_with_league()`
- `types.rs` โ `is_previous_season`, `league_name`
- `App.tsx` โ ะฒะธะทัะฐะปัะฝัะน ะฑะตะนะดะถ ะดะปั ััะฐััั ัะตะฝ
- `PriceModerationPage.tsx` โ ะฐะดะผะธะฝะบะฐ ั 3 ะฒะบะปะฐะดะบะฐะผะธ

---

## 3. ะะธะทะฐะนะฝ ะพะฒะตัะปะตั

### ะขัะตะฑะพะฒะฐะฝะธั
- **ะะธะฝะธะผะฐะปัะฝะพะต ะฒะผะตัะฐัะตะปัััะฒะพ** โ ะฝะต ะผะตัะฐัั ะธะณัะพะฒะพะผั ะฟัะพัะตััั
- **ะะพะปัะฟัะพะทัะฐัะฝะพััั** โ ะฒะธะดะตัั ะธะณัั ัะบะฒะพะทั ะพะฒะตัะปะตะน
- **ะะพะผะฟะฐะบัะฝะพััั** โ ะทะฐะฝะธะผะฐัั ะผะธะฝะธะผัะผ ะผะตััะฐ
- **ะัััััะน ะดะพัััะฟ** โ ะบะฝะพะฟะบะธ ะดะปั ะพัะฝะพะฒะฝัั ะดะตะนััะฒะธะน

### ะะพะฝัะตะฟัะธั ะดะธะทะฐะนะฝะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         ะะะะ                                 โ
โ                                                              โ
โ  โโโโ  โญโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฎ              โ
โ  โ๐โ  โ  Session: 2h 15m      [โถ Pause]    โ              โ
โ  โโโโค  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ              โ
โ  โ๐ฐโ  โ  Total Value: 12,450 FE             โ              โ
โ  โโโโค  โ  FE/hour: 5,533                     โ              โ
โ  โโโ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ              โ
โ  โโโโค  โ  Last drops:                        โ              โ
โ  โโ๏ธโ  โ   โข Flame Sand x5      (250 FE)    โ              โ
โ  โโโโ  โ   โข Deep Focus         (1,200 FE)  โ              โ
โ        โฐโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฏ              โ
โ                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะญะปะตะผะตะฝัั UI

#### ะะตััะธะบะฐะปัะฝะฐั ะฟะฐะฝะตะปั ะบะฝะพะฟะพะบ (ัะปะตะฒะฐ)
- ๐ Stats โ ะฟะพะบะฐะทะฐัั/ัะบัััั ััะฐัะธััะธะบั
- ๐ฐ Drops โ ัะฟะธัะพะบ ะดัะพะฟะฐ
- โ Add โ ัััะฝะพะต ะดะพะฑะฐะฒะปะตะฝะธะต ะฟัะตะดะผะตัะฐ
- โ๏ธ Settings โ ะฝะฐัััะพะนะบะธ

#### ะะพะปัะฟัะพะทัะฐัะฝะพะต ะพะบะฝะพ
- ะคะพะฝ: `rgba(0, 0, 0, 0.6)` ะธะปะธ ะฝะฐัััะฐะธะฒะฐะตะผะฐั ะฟัะพะทัะฐัะฝะพััั
- ะกะบััะณะปะตะฝะฝัะต ัะณะปั
- ะขะตะฝั ะดะปั ะฒัะดะตะปะตะฝะธั ะพั ะธะณัั
- ะะปะฐะฒะฝัะต ะฐะฝะธะผะฐัะธะธ ะฟะพัะฒะปะตะฝะธั/ัะบัััะธั

### CSS ะบะพะฝัะตะฟั
```css
.overlay-panel {
  background: rgba(15, 15, 20, 0.75);
  backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
}

.vertical-buttons {
  display: flex;
  flex-direction: column;
  gap: 4px;
  background: rgba(20, 20, 25, 0.9);
  border-radius: 8px;
  padding: 4px;
}

.icon-button {
  width: 36px;
  height: 36px;
  border-radius: 6px;
  background: transparent;
  transition: background 0.2s;
}

.icon-button:hover {
  background: rgba(255, 255, 255, 0.1);
}
```

### ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะธะดะตะธ
- **Draggable** โ ะฟะตัะตะผะตัะตะฝะธะต ะพะฒะตัะปะตั ะฒ ะปัะฑะพะต ะผะตััะพ ัะบัะฐะฝะฐ
- **Collapse** โ ัะฒะพัะฐัะธะฒะฐะฝะธะต ะฒ ะผะธะฝะธะผะฐะปัะฝัั ะฟะฐะฝะตะปั
- **Hotkeys** โ ะณะพัััะธะต ะบะปะฐะฒะธัะธ ะดะปั ะฟะพะบะฐะทะฐ/ัะบัััะธั (ะฝะฐะฟัะธะผะตั, F12)
- **Auto-hide** โ ะฐะฒัะพัะบัััะธะต ะบะพะณะดะฐ ะฝะตั ะฐะบัะธะฒะฝะพััะธ

---

## 4. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ััะฝะบัะธะธ

### 4.1 ะะฝะพะฟะบะฐ ะฟะฐัะทั ัะตััะธะธ

**ะะฐัะตะผ:** ะัะปะธ ะธะณัะพะบ ะพัะพััะป ะพั ะบะพะผะฟัััะตัะฐ, ะฒัะตะผั ะฝะต ะดะพะปะถะฝะพ ััะธัะฐัััั.

**ะะตะฐะปะธะทะฐัะธั:**
- ะะฝะพะฟะบะฐ โถ/โธ ะฒ UI
- ะัะธ ะฟะฐัะทะต:
  - ะััะฐะฝะฐะฒะปะธะฒะฐัั ัะฐะนะผะตั ัะตััะธะธ
  - ะะต ััะธััะฒะฐัั ะฟะฐัะทั ะฒ ัะฐััััะต FE/hour
  - ะะพะบะฐะทัะฒะฐัั ะธะฝะดะธะบะฐัะพั "PAUSED"

**Rust (state.rs):**
```rust
pub struct SessionState {
    // ...existing fields...
    paused_at: Option<DateTime<Utc>>,
    total_paused_time: Duration,
}

pub fn pause_session(&self) {
    self.paused_at = Some(Utc::now());
}

pub fn resume_session(&self) {
    if let Some(paused_at) = self.paused_at {
        self.total_paused_time += Utc::now() - paused_at;
        self.paused_at = None;
    }
}

pub fn effective_duration(&self) -> Duration {
    let total = Utc::now() - self.started_at;
    total - self.total_paused_time
}
```

### 4.2 ะััะฝะพะต ะดะพะฑะฐะฒะปะตะฝะธะต ะฟัะตะดะผะตัะพะฒ

**ะะฐัะตะผ:** ะะต ะฒัะต ะฟัะตะดะผะตัั ะฟะพะฟะฐะดะฐัั ะฒ ะปะพะณ (ัะพัะณะพะฒะปั, ะบัะฐัั, ะฝะฐะณัะฐะดั).

**UI:**
- ะะฝะพะฟะบะฐ โ "Add Drop"
- ะะพะธัะบ ะฟัะตะดะผะตัะฐ ะฟะพ ะฝะฐะทะฒะฐะฝะธั (ะฐะฒัะพะบะพะผะฟะปะธั ะธะท ะะ)
- ะะฒะพะด ะบะพะปะธัะตััะฒะฐ
- ะะพะฑะฐะฒะปะตะฝะธะต ะบ ัะตััะธะธ

**ะะฝัะตััะตะนั:**
```
โญโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฎ
โ  โ Add Drop                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  Search: [Flame Sa_________] ๐  โ
โ         โโโโโโโโโโโโโโโโโโโโโโโ  โ
โ         โ Flame Sand     250  โ  โ
โ         โ Flame Elementium 1  โ  โ
โ         โโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  Amount: [___5___]               โ
โ                                  โ
โ  [Cancel]          [Add to Drop] โ
โฐโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฏ
```

### 4.3 ะะฐัััั ะบะพะผะธััะธะธ

**ะะฐัะตะผ:** ะัะธ ะฟัะพะดะฐะถะต ะฝะฐ ะฐัะบัะธะพะฝะต ะฒะทะธะผะฐะตััั ะบะพะผะธััะธั. ะะตะฐะปัะฝัะน ะดะพัะพะด ะผะตะฝััะต.

**ะะพะผะธััะธั ะฒ TLI:**
- **12.5%** ะพั ััะผะผั ัะดะตะปะบะธ
- Flame Elementium โ ะะะ ะบะพะผะธััะธะธ (ะฑะฐะทะพะฒะฐั ะฒะฐะปััะฐ)

**ะะตะฐะปะธะทะฐัะธั:**
```rust
const AUCTION_FEE_RATE: f64 = 0.125; // 12.5%
const BASE_CURRENCY_ID: i64 = 100300; // Flame Elementium

pub fn calculate_net_value(game_id: i64, gross_value: f64) -> f64 {
    if game_id == BASE_CURRENCY_ID {
        gross_value // ะะตะท ะบะพะผะธััะธะธ
    } else {
        gross_value * (1.0 - AUCTION_FEE_RATE)
    }
}
```

**ะ UI ะฟะพะบะฐะทัะฒะฐัั:**
- Gross Value: 12,450 FE (ะดะพ ะบะพะผะธััะธะธ)
- Net Value: 10,894 FE (ะฟะพัะปะต ะบะพะผะธััะธะธ)
- Fee: -1,556 FE (12.5%)

### 4.4 ะกะพััะฐะฝะตะฝะธะต ะธ ัะธะฝััะพะฝะธะทะฐัะธั ัะตััะธะน

**ะะฐัะตะผ:** ะกะพััะฐะฝััั ะธััะพัะธั ัะฐัะผ-ัะตััะธะน ะดะปั ะฐะฝะฐะปะธะทะฐ ะธ ัะธะฝััะพะฝะธะทะฐัะธะธ ั kripika.com.

**ะคัะฝะบัะธะพะฝะฐะป:**
- ๐พ **ะะพะบะฐะปัะฝะพะต ัะพััะฐะฝะตะฝะธะต** โ ะบะฐะถะดะฐั ัะตััะธั ัะพััะฐะฝัะตััั ะฒ JSON
- โ๏ธ **ะกะธะฝััะพะฝะธะทะฐัะธั** โ ะพัะฟัะฐะฒะบะฐ ะฝะฐ ัะตัะฒะตั ะฟัะธ ะทะฐะฒะตััะตะฝะธะธ
- ๐ **ะััะปะฐะนะฝ ัะตะถะธะผ** โ ะฝะฐะบะพะฟะปะตะฝะธะต ัะตััะธะน ะดะปั ัะธะฝััะพะฝะธะทะฐัะธะธ ะฟะพะทะถะต
- ๐ **ะััะพัะธั** โ ะฟัะพัะผะพัั ะฟัะพัะปัั ัะตััะธะน ะฒ ะฟัะธะปะพะถะตะฝะธะธ ะธ ะฝะฐ ัะฐะนัะต

**ะกัััะบัััะฐ ัะตััะธะธ:**
```typescript
interface SavedSession {
  id: string;
  started_at: string;
  ended_at: string;
  duration_sec: number;
  active_duration_sec: number;  // ะฑะตะท ะฟะฐัะท
  drops: { game_id, quantity, unit_price, total_value }[];
  expenses: { category, amount, quantity }[];
  summary: {
    gross_income: number;
    total_expenses: number;
    auction_fee: number;        // 12.5%
    net_profit: number;
    profit_per_hour: number;
  };
  sync_status: 'pending' | 'synced' | 'failed';
  league_id: string;
}
```

**ะะพัััะฐะฝะพะฒะปะตะฝะธะต ะฟัะธ ัะฑะพะต:**
- ะัะธ ะฐะฒะฐัะธะนะฝะพะผ ะทะฐะบัััะธะธ โ ะฟัะตะดะปะพะถะธัั ะฟัะพะดะพะปะถะธัั ะธะปะธ ะทะฐะฒะตััะธัั

---

### 4.5 ะััะปะตะถะธะฒะฐะฝะธะต ััะฐั ะฟัะธ ัะฐัะผะต

**ะะฐัะตะผ:** ะคะฐัะผ ััะตะฑัะตั ัะฐััะพะดะฝะธะบะพะฒ โ ะบะพะผะฟะฐัั, ะบะฐััั, ะทะตะปัั ะธ ั.ะด. ะะตะท ััััะฐ ััะฐั ะฝะตะฒะพะทะผะพะถะฝะพ ะฟะพะฝััั ัะตะฐะปัะฝัั ะฟัะธะฑัะปั.

**ะขะธะฟั ััะฐั:**
- ๐งญ **ะะพะผะฟะฐัั** โ ะพัะบัััะธะต ะบะฐัั Netherrealm
- ๐บ๏ธ **ะะฐััั/ะฑะธะปะตัั** โ ะฒัะพะด ะฒ ะพะฟัะตะดะตะปัะฝะฝัะน ะบะพะฝัะตะฝั
- ๐ **ะะฐััะพะดะฝะธะบะธ** โ ะทะตะปัั, ะฑะฐััั
- ๐ง **ะัะฐัั** โ ะฟะพะฟััะบะธ ะบัะฐััะฐ, ัะตัะพะปะป, ัะปัััะตะฝะธะต

**ะกะฟะพัะพะฑั ะฒะฒะพะดะฐ:**

#### ะะฐัะธะฐะฝั A: ะััะฝะพะน ะฒะฒะพะด
```
โญโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฎ
โ  ๐ธ Add Expense                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  Type: [Compass โผ]               โ
โ  Item: [Star Net Compass___] ๐  โ
โ  Amount: [___5___]               โ
โ  Price per unit: [___120___] FE  โ
โ  Total: 600 FE                   โ
โ                                  โ
โ  [Cancel]        [Add Expense]   โ
โฐโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฏ
```

#### ะะฐัะธะฐะฝั B: ะะฒัะพะผะฐัะธัะตัะบะพะต ะพััะปะตะถะธะฒะฐะฝะธะต
- ะะฐััะธัั ะปะพะณ ะฝะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟัะตะดะผะตัะพะฒ (ะตัะปะธ ะฒะพะทะผะพะถะฝะพ)
- ะะฐะฟะธััะฒะฐัั ัะฐััะพะด ะบะพะผะฟะฐัะพะฒ ะฟัะธ ะพัะบัััะธะธ ะบะฐัั

#### ะะฐัะธะฐะฝั C: ะจะฐะฑะปะพะฝั ัะฐััะพะดะพะฒ
- ะกะพะทะดะฐัั "ะฟัะตัะตัั" ัะฐัะผะฐ: "1 ัะฐั Netherrealm = 20 ะบะพะผะฟะฐัะพะฒ"
- ะะฒัะพะผะฐัะธัะตัะบะธ ะฒััะธัะฐัั ะฟัะธ ะทะฐะฒะตััะตะฝะธะธ ัะตััะธะธ

**ะะฐัััั ะฟัะธะฑัะปะธ:**
```rust
pub struct SessionStats {
    // Income
    total_drops_value: f64,      // ะกัะผะผะฐ ะดัะพะฟะฐ
    
    // Expenses
    total_expenses: f64,         // ะกัะผะผะฐ ััะฐั
    expenses_breakdown: HashMap<String, f64>, // ะะพ ะบะฐัะตะณะพัะธัะผ
    
    // Net
    net_profit: f64,             // = drops - expenses - fees
    profit_per_hour: f64,        // ะงะธััะฐั ะฟัะธะฑัะปั ะฒ ัะฐั
}
```

**ะ UI ะฟะพะบะฐะทัะฒะฐัั:**
```
โญโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฎ
โ  ๐ Session Summary                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โฑ๏ธ Duration: 2h 15m                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  ๐ฐ Drops:        +12,450 FE        โ
โ  ๐ธ Expenses:      -1,200 FE        โ
โ     โโ Compasses:    -600 FE        โ
โ     โโ Maps:         -600 FE        โ
โ  ๐ฆ Fees (3%):       -337 FE        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โจ Net Profit:   +10,913 FE        โ
โ  ๐ Per Hour:      +4,850 FE/h      โ
โฐโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฏ
```

**ะัะธะพัะธัะตั:** ะกัะตะดะฝะธะน โ ะฟะพัะปะต ะฑะฐะทะพะฒะพะณะพ UI

---

## ๐ ะัะธะพัะธัะตัั

| # | ะัะพะฑะปะตะผะฐ | ะกะปะพะถะฝะพััั | ะะฐะถะฝะพััั | ะกัะฐััั |
|---|----------|-----------|----------|--------|
| 1 | ะัะตะดะผะตัั ัะพ ััะฐัะฐะผะธ | ะะธะทะบะฐั | ะััะพะบะฐั | โ ะะพัะพะฒะพ |
| 2a | ะะธะณะธ + ััะฐะฝะตะฝะธะต | ะกัะตะดะฝัั | ะััะพะบะฐั | โ ะะพัะพะฒะพ |
| 2b | ะะตัะตะบัะธั ะฐะฝะพะผะฐะปะธะน | ะกัะตะดะฝัั | ะััะพะบะฐั | โ ะะพัะพะฒะพ |
| 2c | ะะดะผะธะฝ-ะฟะฐะฝะตะปั ะผะพะดะตัะฐัะธะธ | ะกัะตะดะฝัั | ะััะพะบะฐั | โ ะะพัะพะฒะพ |
| 2d | Telegram ัะฒะตะดะพะผะปะตะฝะธั | ะะธะทะบะฐั | ะกัะตะดะฝัั | โ ะะพัะพะฒะพ |
| 2e | Fallback ัะตะฝ ัะตะทะพะฝะฐ | ะกัะตะดะฝัั | ะััะพะบะฐั | โ ะะพัะพะฒะพ |
| 3 | ะะธะทะฐะนะฝ ะพะฒะตัะปะตั | ะััะพะบะฐั | ะกัะตะดะฝัั | ๐ ะะพะทะถะต |
| 4a | ะะฐัะทะฐ ัะตััะธะธ | ะะธะทะบะฐั | ะกัะตะดะฝัั | ๐ ะะพะทะถะต |
| 4b | ะััะฝะพะน ะฒะฒะพะด ะดัะพะฟะฐ | ะกัะตะดะฝัั | ะะธะทะบะฐั | ๐ ะะพะทะถะต |
| 4c | ะะฐัััั ะบะพะผะธััะธะธ | ะะธะทะบะฐั | ะกัะตะดะฝัั | ๐ ะะพะทะถะต |
| 4d | **ะกะพััะฐะฝะตะฝะธะต ัะตััะธะน** | ะกัะตะดะฝัั | **ะััะพะบะฐั** | ๐ ะะพะทะถะต |
| 4e | **ะััะปะตะถะธะฒะฐะฝะธะต ััะฐั** | ะกัะตะดะฝัั | **ะััะพะบะฐั** | ๐ ะะพะทะถะต |

---

## ๐ ะะปะฐะฝ ะดะตะนััะฒะธะน

### ะคะฐะทะฐ 1: ะกัะฐะฑะธะปัะฝะพััั ะดะฐะฝะฝัั โ
- [x] ะะณะฝะพัะธัะพะฒะฐะฝะธะต ะฝะตะธะทะฒะตััะฝัั ะฟัะตะดะผะตัะพะฒ ะฒ ะดัะพะฟะฐั
- [x] ะะปะพะบะธัะพะฒะบะฐ ัะตะฝั ะฑะฐะทะพะฒะพะน ะฒะฐะปััั (Flame Elementium = 1.0)
- [x] ะะพะบัะผะตะฝัะฐัะธั ะพััะปะตะถะธะฒะฐะตะผัั ะฟัะตะดะผะตัะพะฒ

### ะคะฐะทะฐ 2: ะะธะณะธ + ะะตัะตะบัะธั ะฐะฝะพะผะฐะปะธะน โ
- [x] **ะะ:** ะขะฐะฑะปะธัะฐ `tli_league_settings` (SS10, SS11)
- [x] **ะะ:** ะะพะฑะฐะฒะธัั `league_id` ะฒ ัะฐะฑะปะธัั ัะตะฝ
- [x] **ะะ:** ะกะพะทะดะฐัั ัะฐะฑะปะธัั `tli_suspicious_prices`
- [x] **RPC:** ะะพะดะธัะธัะธัะพะฒะฐัั `upsert_market_price` ะดะปั ะดะตัะตะบัะธะธ
- [x] **RPC:** ะกะพะทะดะฐัั `get_prices_with_fallback()` ะดะปั fallback
- [x] **ะะดะผะธะฝะบะฐ:** ะกััะฐะฝะธัะฐ `/admin/prices` ั 3 ะฒะบะปะฐะดะบะฐะผะธ
- [x] **ะะดะผะธะฝะบะฐ:** ะะพะดะตัะฐัะธั ะฟะพะดะพะทัะธัะตะปัะฝัั ัะตะฝ
- [x] **ะะดะผะธะฝะบะฐ:** ะขะฐะฑะปะธัะฐ ัะตะบััะธั ัะตะฝ
- [x] **ะะดะผะธะฝะบะฐ:** ะฃะฟัะฐะฒะปะตะฝะธะต ะปะธะณะฐะผะธ
- [x] **Telegram:** Edge Function ัะฒะตะดะพะผะปะตะฝะธะน
- [x] **Tauri:** ะะพะดะดะตัะถะบะฐ ัะตะทะพะฝะฝะพััะธ + ะฑะตะนะดะถ ััะฐััั ัะตะฝ

### ะคะฐะทะฐ 3: UI/UX
- [ ] ะะตะดะธะทะฐะนะฝ ะฒ ััะธะปะต ะพะฒะตัะปะตั
- [ ] ะะพะปัะฟัะพะทัะฐัะฝะพััั
- [ ] ะะตััะธะบะฐะปัะฝัะต ะบะฝะพะฟะบะธ
- [ ] Drag & drop ะฟะพะทะธัะธะธ

### ะคะฐะทะฐ 4: ะะพะฟะพะปะฝะธัะตะปัะฝัะต ััะฝะบัะธะธ
- [ ] ะะฐัััั ะบะพะผะธััะธะธ (12.5%)
- [ ] ะะฐัะทะฐ ัะตััะธะธ
- [ ] ะััะฝะพะน ะฒะฒะพะด ะดัะพะฟะฐ
- [ ] **ะกะพััะฐะฝะตะฝะธะต ัะตััะธะน** (ะปะพะบะฐะปัะฝะพ + ัะธะฝััะพะฝะธะทะฐัะธั ั kripika.com)
- [ ] **ะััะปะตะถะธะฒะฐะฝะธะต ััะฐั** (ะบะพะผะฟะฐัั, ะบะฐััั, ัะฐััะพะดะฝะธะบะธ)
- [ ] ะะฐัััั ัะธััะพะน ะฟัะธะฑัะปะธ (drops - expenses - fees)
- [ ] ะะพัััะธะต ะบะปะฐะฒะธัะธ
- [ ] ะััะพัะธั ัะตััะธะน (ะฟัะพัะผะพัั ะฟัะพัะปัั ัะตััะธะน)

---

## 5. ะกะธััะตะผะฐ ะฐะฒัะพัะธะทะฐัะธะธ

### ะะฟะธัะฐะฝะธะต
ะัะถะฝะฐ ัะธััะตะผะฐ ัะฐะทะดะตะปะตะฝะธั ะณะพััะตะฒะพะณะพ ะธ ะฐะฒัะพัะธะทะพะฒะฐะฝะฝะพะณะพ ะดะพัััะฟะฐ.

### ะะพััะตะฒะพะน ัะตะถะธะผ (ะฑะตะท ะปะพะณะธะฝะฐ)

**ะงัะพ ัะฐะฑะพัะฐะตั:**
- โ ะขัะตะบะธะฝะณ ะดัะพะฟะฐ (ะปะพะบะฐะปัะฝะพ)
- โ ะัะพะฑัะฐะถะตะฝะธะต ัะตะฝ (ะธะท ะปะพะบะฐะปัะฝะพะณะพ ะบััะฐ)
- โ ะะฐัััั ัะตััะธะน (ะปะพะบะฐะปัะฝะพ)
- โ ะััะฝะพะต ะดะพะฑะฐะฒะปะตะฝะธะต ะดัะพะฟะฐ/ััะฐั
- โ ะะฐัะทะฐ ัะตััะธะธ

**ะงัะพ ะะ ัะฐะฑะพัะฐะตั:**
- โ ะัะฐะนััะตะบะธ ะะ ะทะฐะฟะธััะฒะฐัััั ะฒ ะพะฑััั ะะ
- โ ะกะธะฝััะพะฝะธะทะฐัะธั ัะตััะธะน ั ัะตัะฒะตัะพะผ
- โ ะะพัััะฟ ะบ crowd-ัะตะฝะฐะผ (ัััะตะดะฝัะฝะฝัะต ัะตะฝั ัะพะพะฑัะตััะฒะฐ)
- โ ะัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั

### ะะฒัะพัะธะทะพะฒะฐะฝะฝัะน ัะตะถะธะผ (ั ะปะพะณะธะฝะพะผ)

**ะัะต ััะฝะบัะธะธ ะณะพััะตะฒะพะณะพ ัะตะถะธะผะฐ ะะะฎะก:**
- โ **ะัะฐะนััะตะบะธ ะทะฐะฟะธััะฒะฐัััั ะฒ ะะ** โ ะฒะฝะพััั ะฒะบะปะฐะด ะฒ ะพะฑัะธะต ัะตะฝั
- โ **ะกะธะฝััะพะฝะธะทะฐัะธั ัะตััะธะน** โ ัะตััะธะธ ัะพััะฐะฝััััั ะฝะฐ ัะตัะฒะตัะต
- โ **Crowd-ัะตะฝั** โ ะดะพัััะฟ ะบ ัััะตะดะฝัะฝะฝัะผ ัะตะฝะฐะผ ะพั ัะพะพะฑัะตััะฒะฐ
- โ **ะััะพัะธั** โ ะฟัะพัะผะพัั ะฒัะตั ัะฒะพะธั ัะตััะธะน ะฝะฐ kripika.com
- โ **ะัะพัะธะปั** โ ััะพะฒะตะฝั, XP, ะดะพััะธะถะตะฝะธั

### ะขะตัะฝะธัะตัะบะฐั ัะตะฐะปะธะทะฐัะธั

#### 1. ะัะฐะนััะตะบะธ ัะพะปัะบะพ ะพั ะทะฐะปะพะณะธะฝะตะฝะฝัั

**Backend (Rust):**
```rust
// ะ file_watcher.rs ะฟัะธ ะพะฑัะฐะฑะพัะบะต PriceCheck ัะพะฑััะธั
async fn handle_price_check(&self, event: PriceEvent, state: &AppState) {
    // ะะพะบะฐะปัะฝะพ ะพะฑะฝะพะฒะปัะตะผ ะบัั ะฒัะตะณะดะฐ
    state.update_price(event.game_id, event.price).await;
    
    // ะ ะะ ะทะฐะฟะธััะฒะฐะตะผ ะขะะะฌะะ ะตัะปะธ ะทะฐะปะพะณะธะฝะตะฝ
    if state.is_authenticated().await {
        if let Some(cfg) = state.resolve_supabase_config().await {
            supabase_sync::upsert_market_price(&http, &cfg, event).await;
        }
    }
}
```

**Supabase RPC:**
```sql
-- ะคัะฝะบัะธั upsert_market_price ะดะพะปะถะฝะฐ ะฟัะพะฒะตัััั user_id
CREATE OR REPLACE FUNCTION upsert_market_price(...)
RETURNS void AS $$
BEGIN
  -- ะัะพะฒะตััะตะผ ััะพ user_id ะฝะต NULL (ะทะฐะปะพะณะธะฝะตะฝ)
  IF p_user_id IS NULL THEN
    RAISE EXCEPTION 'Price checks require authentication';
  END IF;
  
  -- ... ะพััะฐะปัะฝะฐั ะปะพะณะธะบะฐ
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

#### 2. UI ะธะฝะดะธะบะฐัะธั

**ะ sidebar:**
- ๐ต ะะฐะปะพะณะธะฝะตะฝ โ ะฐะฒะฐัะฐั ั ัะธะพะปะตัะพะฒะพะน ะพะฑะฒะพะดะบะพะน
- โช ะะพััั โ ัะตัะฐั ะธะบะพะฝะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั

**ะ ััะฐััั-ะฑะฐัะต:**
- ะะฐะปะพะณะธะฝะตะฝ: "โ ะกะธะฝัั." (ะทะตะปัะฝะฐั ัะพัะบะฐ)
- ะะพััั: "โ ะะพะบะฐะปัะฝะพ" (ัะตัะฐั ัะพัะบะฐ)

#### 3. ะะพะบะฐะปัะฝะพะต ััะฐะฝะตะฝะธะต

**ะะพััะธ:**
- ะฆะตะฝั: ะบััะธัััััั ะปะพะบะฐะปัะฝะพ, ะพะฑะฝะพะฒะปััััั ะฟัะธ ะทะฐะฟััะบะต ะธะท ะฟัะฑะปะธัะฝัั ะดะฐะฝะฝัั
- ะกะตััะธะธ: ัะพะปัะบะพ ะฒ localStorage, ะฑะตะท ัะธะฝััะพะฝะธะทะฐัะธะธ

**ะะฐะปะพะณะธะฝะตะฝะฝัะต:**
- ะฆะตะฝั: ะบััะธัััััั ะปะพะบะฐะปัะฝะพ + ัะธะฝััะพะฝะธะทะธัััััั ั ัะตัะฒะตัะพะผ
- ะกะตััะธะธ: ัะพััะฐะฝััััั ะฝะฐ ัะตัะฒะตัะต + ะปะพะบะฐะปัะฝัะน ะฑัะบะฐะฟ

### ะกัะฐััั: ๐ ะขัะตะฑัะตั ัะตะฐะปะธะทะฐัะธะธ

**TODO:**
- [ ] ะะพะฑะฐะฒะธัั ะฟัะพะฒะตัะบั `is_authenticated` ะฒ `file_watcher.rs`
- [ ] ะะฑะฝะพะฒะธัั `upsert_market_price` RPC ะดะปั ะฟัะพะฒะตัะบะธ user_id
- [ ] ะะพะฑะฐะฒะธัั ะธะฝะดะธะบะฐัะพั "ะกะธะฝัั./ะะพะบะฐะปัะฝะพ" ะฒ ััะฐััั-ะฑะฐั
- [ ] ะะฑะฝะพะฒะธัั UI ะผะพะดะฐะปะบะธ ะปะพะณะธะฝะฐ ั ะพะฑัััะฝะตะฝะธะตะผ ะฟัะตะธะผััะตััะฒ

---

## ๐ฌ ะัะบััััะต ะฒะพะฟัะพัั

1. ~~**ะะพะผะธััะธั ะฐัะบัะธะพะฝะฐ**~~ โ **12.5%** โ ะฟัะธะผะตะฝัะตััั ะขะะะฌะะ ะบ ะดะพัะพะดั (ะฟัะพะดะฐะถะฐ), ะะ ะบ ััะฐัะฐะผ (ะฟะพะบัะฟะบะฐ)
2. ~~**ะะธะณะธ** โ ะบะฐะบะธะต ะปะธะณะธ ัะตะนัะฐั ะฐะบัะธะฒะฝั?~~ โ SS10 (ัะตะบััะฐั) + SS11 (16 ัะฝะฒะฐัั)
3. **ะัะตะดะผะตัั ัะพ ััะฐัะฐะผะธ** โ ัะพัะธะผ ะปะธ ะผั ะฒะพะพะฑัะต ะธั ะพััะปะตะถะธะฒะฐัั ะฒ ะฑัะดััะตะผ?
4. ~~**Overlay position**~~ โ ะกะพััะฐะฝัะตััั ะฒ localStorage
5. **ะขัะฐัั ะฟัะธ ัะฐัะผะต:**
   - ะะพะถะฝะพ ะปะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพััะปะตะถะธะฒะฐัั ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะบะพะผะฟะฐัะพะฒ/ะบะฐัั ะธะท ะปะพะณะพะฒ?
   - ะะปะธ ัะพะปัะบะพ ัััะฝะพะน ะฒะฒะพะด?
   - ะะฐะบะธะต ะบะฐัะตะณะพัะธะธ ััะฐั ะฝัะถะฝั? (ะบะพะผะฟะฐัั, ะบะฐััั, ะบัะฐัั, ะดััะณะพะต)
6. **ะะฒัะพัะธะทะฐัะธั:**
   - ะะพะปะถะฝั ะปะธ ะณะพััะธ ะฒะธะดะตัั crowd-ัะตะฝั (read-only)?
   - ะะปะธ ัะพะปัะบะพ ะทะฐะปะพะณะธะฝะตะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ?

---

*ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต: 2026-01-13 (ะะพะฑะฐะฒะปะตะฝะฐ ัะธััะตะผะฐ ะฐะฒัะพัะธะทะฐัะธะธ)*
